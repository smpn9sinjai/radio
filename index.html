<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Radio SBFM Sinjai</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{margin:0;padding:0;box-sizing:border-box}

body{
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    font-family:Arial, sans-serif;
    background:white;
}

.overlay{
    position:absolute;
    width:100%;
    height:100%;
    background:white;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    color:#f1f1f1;
}
.card{
    background:black;
    padding:40px 35px;
    border-radius:45px;
    box-shadow:0 20px 50px rgba(0,0,0,0.5);
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:20px;
    width:320px;
	
}
.logo-wrapper{
    position:relative;
    width:260px;
    height:260px;
    display:flex;
    justify-content:center;
    align-items:center;
}

.logo{
    width:170px;
    border-radius:10%;
    z-index:2;
}

canvas{
    position:absolute;
    width:100%;
    height:100%;
}

/* Tombol di tengah logo */
.play-btn{
    position:absolute;
    top:170px;
    width:40px;
    height:40px;
    border-radius:50%;
    border:none;
    background:#4b3e3e;
    color:white;
    font-size:18px;
    cursor:pointer;
    z-index:3;
    display:flex;
    align-items:center;
    justify-content:center;
    transition:0.3s;
}

.play-btn:hover{
    background:#ff9900;
}

/* Status */
.status{
    margin-top:15px;
    font-weight:bold;
    display:none;
}

.volume-control{
    margin-top:15px;
    display:none;
    align-items:center;
    gap:10px;
}

/* Hilangkan style default */
.volume-control input{
    -webkit-appearance:none;
    width:160px;
    height:6px;
    border-radius:5px;
    outline:none;
    background:linear-gradient(to right, #ffb347, #ff8c00);
    cursor:pointer;
}

/* Thumb (bulatan yang digeser) */
.volume-control input::-webkit-slider-thumb{
    -webkit-appearance:none;
    width:16px;
    height:16px;
    border-radius:50%;
    background:#ffffff;
    border:3px solid #ff8c00;
    cursor:pointer;
}

.volume-control input::-moz-range-thumb{
    width:16px;
    height:16px;
    border-radius:50%;
    background:#ffffff;
    border:3px solid #ff8c00;
    cursor:pointer;
}
</style>
</head>
<body>

<div class="overlay">
<div class="card">
    <div class="logo-wrapper">
        <canvas id="visualizer"></canvas>
        <img src="sbfm.png" class="logo">
        <button class="play-btn" id="toggleBtn">â–¶</button>
    </div>

    <div class="status" id="status">ðŸ”´ Sedang Siaran Langsung</div>

    <div class="volume-control">
        ðŸ”Š
        <input type="range" id="volumeSlider" min="0" max="100" value="100">
    </div>
</div>
</div>

<audio id="radioPlayer"></audio>
<script>
const streamURL="https://streaming.sinjaikab.go.id:8443/sbfm";

const audio=document.getElementById("radioPlayer");
const toggleBtn=document.getElementById("toggleBtn");
const volumeSlider=document.getElementById("volumeSlider");
const canvas=document.getElementById("visualizer");
const ctx=canvas.getContext("2d");

let audioCtx, analyser, source, dataArray;
let visualizerAnimationId;
let loadingAnimationId;
let started=false;
let loadingAngle=0;

audio.volume=1;

/* Resize canvas */
function resizeCanvas(){
    canvas.width=canvas.offsetWidth;
    canvas.height=canvas.offsetHeight;
}
resizeCanvas();
window.addEventListener("resize",resizeCanvas);

/* Volume */
volumeSlider.addEventListener("input",()=>{
    audio.volume=volumeSlider.value/100;
});

/* PLAY BUTTON */
toggleBtn.addEventListener("click",()=>{
   toggleBtn.style.display="none"
    if(!started){
        audio.src=streamURL+"?t="+Date.now();
        audio.crossOrigin="anonymous";
        audio.play();
        started=true;
        startLoading();
    }else{
        if(audio.paused){
            audio.play();
            startLoading();
			 toggleBtn.style.display="block"
        }else{
            audio.pause();
			 started=false;
			  toggleBtn.style.display="block"
        }
    }

});

/* ERROR */
audio.addEventListener("error",()=>{
    started=false;
    toggleBtn.textContent="â–¶";
    stopAllAnimation();
	 startLoading();
	  toggleBtn.style.display="block"
});

/* PLAYING */
audio.addEventListener("playing",()=>{

    stopLoading();

    toggleBtn.textContent="â¹";
    document.getElementById("status").style.display="block";
    document.querySelector(".volume-control").style.display="flex";

    initAudio();
});

/* PAUSE */
audio.addEventListener("pause",()=>{
    toggleBtn.textContent="â–¶";
    document.getElementById("status").style.display="none";
    document.querySelector(".volume-control").style.display="none";

    stopAllAnimation();
});

/* ========================= */
/* LOADING */
/* ========================= */

function startLoading(){
    stopVisualizer();
    drawLoading();
}

function drawLoading(){
    loadingAnimationId=requestAnimationFrame(drawLoading);

    ctx.clearRect(0,0,canvas.width,canvas.height);

    const centerX=canvas.width/2;
    const centerY=canvas.height/2;
    const radius=95;

    loadingAngle+=0.08;

    ctx.beginPath();
    ctx.arc(centerX,centerY,radius,loadingAngle,loadingAngle+Math.PI*1.5);
    ctx.strokeStyle="orange";
    ctx.lineWidth=4;
    ctx.stroke();
}

function stopLoading(){
    cancelAnimationFrame(loadingAnimationId);
}

/* ========================= */
/* AUDIO ANALYSER */
/* ========================= */

function initAudio(){

    if(!audioCtx){
        audioCtx=new (window.AudioContext||window.webkitAudioContext)();
        analyser=audioCtx.createAnalyser();
        source=audioCtx.createMediaElementSource(audio);

        source.connect(analyser);
        analyser.connect(audioCtx.destination);

        analyser.fftSize=128;
        dataArray=new Uint8Array(analyser.frequencyBinCount);
    }

    if(audioCtx.state==="suspended"){
        audioCtx.resume();
    }

    drawVisualizer();
}

/* ========================= */
/* EQUALIZER */
/* ========================= */

function drawVisualizer(){
      toggleBtn.style.display="block"
    visualizerAnimationId=requestAnimationFrame(drawVisualizer);

    analyser.getByteFrequencyData(dataArray);

    ctx.clearRect(0,0,canvas.width,canvas.height);

    const centerX=canvas.width/2;
    const centerY=canvas.height/2;
    const radius=85;
    const bars=dataArray.length;
    const step=(Math.PI*2)/bars;

    for(let i=0;i<bars;i++){

        const value=dataArray[i];
        const barHeight=value/3;
        const angle=i*step;

        const x1=centerX+Math.cos(angle)*radius;
        const y1=centerY+Math.sin(angle)*radius;

        const x2=centerX+Math.cos(angle)*(radius+barHeight);
        const y2=centerY+Math.sin(angle)*(radius+barHeight);

        ctx.strokeStyle=`hsl(${i*3},100%,50%)`;
        ctx.lineWidth=3;

        ctx.beginPath();
        ctx.moveTo(x1,y1);
        ctx.lineTo(x2,y2);
        ctx.stroke();
    }
}

function stopVisualizer(){
    cancelAnimationFrame(visualizerAnimationId);
}

function stopAllAnimation(){
    cancelAnimationFrame(loadingAnimationId);
    cancelAnimationFrame(visualizerAnimationId);
    ctx.clearRect(0,0,canvas.width,canvas.height);
}

 audio.addEventListener("stalled", () => {
   stopAllAnimation()
   startLoading();
});

audio.addEventListener("abort", () => {
     stopAllAnimation()
   startLoading();
});

audio.addEventListener("emptied", () => {
    stopAllAnimation()
   startLoading();
});
</script>

</body>
</html>
