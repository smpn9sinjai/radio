<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Radio SBFM Sinjai</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    font-family:Arial, sans-serif;
    background:url('background.jpg') no-repeat center center/cover;
    overflow:hidden;
}

.overlay{
    position:absolute;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.75);
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    text-align:center;
    color:white;
}

.logo{
    width:200px;
    margin-bottom:20px;
}

.listen-btn{
    padding:10px 20px;
    font-size:16px;
    border:none;
    border-radius:30px;
    background:#00ffcc;
    color:#000;
    cursor:pointer;
    transition:0.3s;
}
.listen-btn:hover{
    background:#00ccaa;
    transform:scale(1.05);
}

.controls{
    display:none;
    gap:10px;
    margin-top:10px;
}

.status{
    font-size:20px;
    font-weight:bold;
    margin:15px 0;
    animation: blink 1.5s infinite;
    display:none;
}

@keyframes blink{
    0%{opacity:1;}
    50%{opacity:0.5;}
    100%{opacity:1;}
}

.equalizer{
    display:none;
    gap:4px;
    margin-top:20px;
    height:50px;
}
.bar{
    width:6px;
    background:#00ffcc;
    height:10px;
    border-radius:3px;
}

.volume{
    display:none;
    margin-top:15px;
    width:200px;
    height:8px;
    background:#444;
    border-radius:10px;
    overflow:hidden;
}
.volume-fill{
    height:100%;
    width:0%;
    background:#00ffcc;
}
</style>
</head>
<body>

<div class="overlay">

    <img src="sbfm.png" class="logo">

    <button class="listen-btn" id="listenBtn">
        üéß Dengarkan Sekarang
    </button>

    <div class="status" id="status">
        üî¥ Sedang Siaran Langsung
    </div>

    <div class="controls" id="controls">
        <button class="listen-btn" onclick="playRadio()">‚ñ∂ Play</button>
        <button class="listen-btn" onclick="stopRadio()">‚èπ Stop</button>
    </div>

    <div class="equalizer" id="equalizer"></div>

    <div class="volume" id="volumeBox">
        <div class="volume-fill" id="volumeFill"></div>
    </div>

</div>

<audio id="radioPlayer"></audio>

<script>
const streamURL = "https://streaming.sinjaikab.go.id:8443/sbfm";
const audio = document.getElementById("radioPlayer");

let audioCtx, analyser, source, dataArray;
let isStarted = false;

// Klik Dengarkan
document.getElementById("listenBtn").addEventListener("click", () => {

    startRadio();

    document.getElementById("listenBtn").style.display="none";
    document.getElementById("status").style.display="block";
    document.getElementById("equalizer").style.display="flex";
    document.getElementById("volumeBox").style.display="block";
    document.getElementById("controls").style.display="flex";
});

// Mulai Streaming
function startRadio(){
    if(isStarted) return;
    isStarted = true;

    audio.src = streamURL + "?t=" + new Date().getTime();
    audio.crossOrigin = "anonymous";
    audio.load();
    audio.play();
    initAudio();
}

// Play Manual
function playRadio(){
    audio.play();
}

// Stop Manual
function stopRadio(){
    audio.pause();
}

// Auto reconnect
audio.addEventListener("error", () => {
    setTimeout(()=> {
        audio.src = streamURL + "?t=" + new Date().getTime();
        audio.play();
    }, 3000);
});

// Setup Visualizer
function initAudio(){
    if(audioCtx) return;

    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    analyser = audioCtx.createAnalyser();
    source = audioCtx.createMediaElementSource(audio);

    source.connect(analyser);
    analyser.connect(audioCtx.destination);

    analyser.fftSize = 64;
    const bufferLength = analyser.frequencyBinCount;
    dataArray = new Uint8Array(bufferLength);

    createBars(bufferLength);
    animate();
}

function createBars(count){
    const eq = document.getElementById("equalizer");
    for(let i=0;i<count;i++){
        const bar = document.createElement("div");
        bar.classList.add("bar");
        eq.appendChild(bar);
    }
}

function animate(){
    requestAnimationFrame(animate);
    analyser.getByteFrequencyData(dataArray);

    const bars = document.querySelectorAll(".bar");
    let total = 0;

    bars.forEach((bar,i)=>{
        const value = dataArray[i];
        bar.style.height = (value/2) + "px";
        total += value;
    });

    const avg = total / dataArray.length;
    document.getElementById("volumeFill").style.width = (avg/2) + "%";
}
</script>

</body>
</html>
